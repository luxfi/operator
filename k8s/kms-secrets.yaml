# GHCR pull secret for lux-operator, synced from Hanzo KMS.
#
# NOTE: If ghcr.io/luxfi/lux-operator is a PUBLIC package, this is not needed
# and you can remove imagePullSecrets from deployment.yaml and serviceaccount.yaml.
#
# Prerequisites (only if package is private):
# 1. In https://kms.hanzo.ai create project "lux-infra" with environment "prod".
# 2. Store a key named ".dockerconfigjson" with value:
#      {"auths":{"ghcr.io":{"auth":"<base64(username:ghcr_pat)>"}}}
# 3. Create auth credential secret out-of-band:
#      kubectl -n lux-system create secret generic universal-auth-credentials \
#        --from-literal=clientId=<id> \
#        --from-literal=clientSecret=<secret> \
#        --dry-run=client -o yaml | kubectl apply -f -
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: ghcr-pull-secret-sync
  namespace: lux-system
  labels:
    app.kubernetes.io/name: lux-operator
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: lux-network
spec:
  hostAPI: https://kms.hanzo.ai/api
  resyncInterval: 3600
  authentication:
    universalAuth:
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: lux-system
      secretsScope:
        projectSlug: lux-infra
        envSlug: prod
        secretsPath: /ghcr
  managedKubeSecretReferences:
    - creationPolicy: Owner
      secretName: ghcr-secret
      secretNamespace: lux-system
      secretType: kubernetes.io/dockerconfigjson
