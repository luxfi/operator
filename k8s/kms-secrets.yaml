# KMS-managed secrets for Lux infrastructure.
#
# All secrets are synced from Hanzo KMS (https://kms.lux.network).
# Auth credentials live in the hanzo namespace (shared across cluster).
#
# Prerequisites:
# 1. KMS operator CRDs installed (secrets.lux.network/v1alpha1)
# 2. universal-auth-credentials secret in hanzo namespace
# 3. In KMS project "lux-infra", environment "prod":
#    - /ghcr/.dockerconfigjson  = {"auths":{"ghcr.io":{"auth":"<base64>"}}}
#    - /registry/.dockerconfigjson = {"auths":{"registry.digitalocean.com":{"auth":"<base64>"}}}

# ── GHCR pull secret (lux-system) ──
# Used by operator deployment for ghcr.io/luxfi/* images
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: ghcr-pull-secret
  namespace: lux-system
  labels:
    app.kubernetes.io/name: lux-operator
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: lux-network
spec:
  hostAPI: https://kms.lux.network/api
  resyncInterval: 3600
  authentication:
    universalAuth:
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: hanzo
      secretsScope:
        projectSlug: lux-infra
        envSlug: prod
        secretsPath: /ghcr
  managedKubeSecretReferences:
    - creationPolicy: Owner
      secretName: ghcr-luxfi
      secretNamespace: lux-system
      secretType: kubernetes.io/dockerconfigjson

# ── DO registry pull secret (lux-system) ──
# Used for building/pushing to DO container registry
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: do-registry-secret
  namespace: lux-system
  labels:
    app.kubernetes.io/name: lux-operator
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: lux-network
spec:
  hostAPI: https://kms.lux.network/api
  resyncInterval: 3600
  authentication:
    universalAuth:
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: hanzo
      secretsScope:
        projectSlug: lux-infra
        envSlug: prod
        secretsPath: /registry
  managedKubeSecretReferences:
    - creationPolicy: Owner
      secretName: registry-hanzo
      secretNamespace: lux-system
      secretType: kubernetes.io/dockerconfigjson

# ── DO registry pull secret (mainnet) ──
# Used by luxd StatefulSet pods to pull bootnode images
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: do-registry-secret
  namespace: lux-mainnet
  labels:
    app.kubernetes.io/name: lux-operator
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: lux-network
spec:
  hostAPI: https://kms.lux.network/api
  resyncInterval: 3600
  authentication:
    universalAuth:
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: hanzo
      secretsScope:
        projectSlug: lux-infra
        envSlug: prod
        secretsPath: /registry
  managedKubeSecretReferences:
    - creationPolicy: Owner
      secretName: registry-hanzo
      secretNamespace: lux-mainnet
      secretType: kubernetes.io/dockerconfigjson

# ── DO registry pull secret (testnet) ──
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: do-registry-secret
  namespace: lux-testnet
  labels:
    app.kubernetes.io/name: lux-operator
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: lux-network
spec:
  hostAPI: https://kms.lux.network/api
  resyncInterval: 3600
  authentication:
    universalAuth:
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: hanzo
      secretsScope:
        projectSlug: lux-infra
        envSlug: prod
        secretsPath: /registry
  managedKubeSecretReferences:
    - creationPolicy: Owner
      secretName: registry-hanzo
      secretNamespace: lux-testnet
      secretType: kubernetes.io/dockerconfigjson

# ── DO registry pull secret (devnet) ──
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: do-registry-secret
  namespace: lux-devnet
  labels:
    app.kubernetes.io/name: lux-operator
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: lux-network
spec:
  hostAPI: https://kms.lux.network/api
  resyncInterval: 3600
  authentication:
    universalAuth:
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: hanzo
      secretsScope:
        projectSlug: lux-infra
        envSlug: prod
        secretsPath: /registry
  managedKubeSecretReferences:
    - creationPolicy: Owner
      secretName: registry-hanzo
      secretNamespace: lux-devnet
      secretType: kubernetes.io/dockerconfigjson
